 # Copyright (c) 2008,2009, University of California, Los Angeles All rights reserved.
 # 
 # Redistribution and use in source and binary forms, with or without
 # modification, are permitted provided that the following conditions are met:
 # 
 # * Redistributions of source code must retain the above copyright notice,
 #     this list of conditions and the following disclaimer.
 # * Redistributions in binary form must reproduce the above copyright
 #     notice, this list of conditions and the following disclaimer in the
 #     documentation and/or other materials provided with the distribution.
 # * Neither the name of NLnetLabs nor the names of its
 #     contributors may be used to endorse or promote products derived from this
 #     software without specific prior written permission.
 # 
 # THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 # AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 # IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 # ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 # LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 # CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 # SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 # INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 # CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 # ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 # POSSIBILITY OF SUCH DAMAGE.

CC=gcc
INCLUDE=-I../include -I/usr/include -I../
#LIB=-L/usr/lib -L/usr/local/lib -L../
LIB=-L/usr/local/lib -L../ -L/lib
CFLAGS=-g -Wall -fPIC 
LFLAGS=-lz -lbz2

SOURCE_OBJ = AttributeType.o \
	AttributeTypeASPath.o \
	AttributeTypeAS4Path.o \
	AttributeTypeAggregator.o \
	AttributeTypeAS4Aggregator.o \
	AttributeTypeAtomicAggregate.o \
	AttributeTypeCommunities.o \
	AttributeTypeExtCommunities.o \
	AttributeTypeLocalPref.o \
	AttributeTypeMPReachNLRI.o \
	AttributeTypeMPUnreachNLRI.o \
	AttributeTypeMultiExitDisc.o \
	AttributeTypeNextHop.o \
	AttributeTypeOrigin.o \
	BGPAttribute.o \
	BGPCommonHeader.o \
	BGPNotification.o \
	BGPOpen.o \
	BGPUpdate.o \
	BGPKeepAlive.o \
	BGPRouteRefresh.o \
	MRTBgp4MPEntry.o \
	MRTBgp4MPMessage.o \
	MRTBgp4MPSnapshot.o \
	MRTBgp4MPStateChange.o \
	MRTCommonHeader.o \
	MRTTblDump.o \
	MRTTblDumpV2PeerIndexTbl.o \
	MRTTblDumpV2RibGeneric.o \
	MRTTblDumpV2RibHeader.o \
	MRTTblDumpV2RibIPv4Multicast.o \
	MRTTblDumpV2RibIPv4Unicast.o \
	MRTTblDumpV2RibIPv6Multicast.o \
	MRTTblDumpV2RibIPv6Unicast.o \
	TblDumpV2RibEntry.o \
	Logger.o 

EXE_TEST_OBJ    = $(SOURCE_OBJ) bgpparser.o cfile_tools.o 
EXE = bgpparser

#all: clean lib
all: lib $(EXE)

bgpparser:  $(EXE_TEST_OBJ)
	$(CC) $(CFLAGS) $(INCLUDE) -o bgpparser $(EXE_TEST_OBJ) $(LIB) -lstdc++ $(LFLAGS)

lib:    libbgpparser.a

libbgpparser.so:    $(SOURCE_OBJ)
	$(CC) -shared -Wl,-soname,libbgpparser.so -o libbgpparser.so.1 $(SOURCE_OBJ) $(LIB) -lstdc++
	ldconfig -n .

libbgpparser.a:     $(SOURCE_OBJ) 
	$(AR) rcs libbgpparser.a $(SOURCE_OBJ)

.cpp.o:
	$(CC) -c $(CFLAGS) $(INCLUDE) $(LDFLAGS) $<

.c.o:
	$(CC) -c $(CFLAGS) $(INCLUDE) $(LDFLAGS) $<

clean:
	rm -f *.o core *.so *.so.1 *.a $(EXE)
